<div class="module">
	<div class="container-fluid">
		<div class="module-heading">
			Report items
		</div>
		<div class="module-body">
			<form>
				<div class="row">
					<div class="form-group col-md-3">
						<ng-include src="'/app/common/libraryItemFolder.html'"></ng-include>
					</div>
					<div class="form-group col-md-9">
						<div class="row">
							<div class="col-md-12">
								<div class="table scroll-box-300">
								<table class="table table-striped table-condensed">
									<thead>
										<tr>
											<th class="col-md-5" ng-click="sortField='name'; sortReverse=!sortReverse">Title
												<span ng-show="sortField == 'name'"
															class="fa fa-sm"
															ng-class="{'fa-chevron-down':!sortReverse, 'fa-chevron-up':sortReverse}"></span>
											</th>
											<th class="col-md-3" ng-click="sortField='lastModified'; sortReverse=!sortReverse">Date modified
												<span ng-show="sortField == 'lastModified'"
															class="fa fa-sm"
															ng-class="{'fa-chevron-down':!sortReverse, 'fa-chevron-up':sortReverse}"></span>
											</th>
											<th class="col-md-2" ng-click="sortField='type'; sortReverse=!sortReverse">Type
												<span ng-show="sortField == 'type'"
															class="fa fa-sm"
															ng-class="{'fa-chevron-down':!sortReverse, 'fa-chevron-up':sortReverse}"></span>
											</th>
											<th class="col-md-2"></th>
										</tr>
									</thead>
									<tbody>
										<tr class="hover-box show-child-on-hover" style="cursor: pointer"
												ng-repeat="item in ctrl.itemSummaryList.contents | orderBy:sortField:sortReverse"
												ng-class="{'selection': item.uuid == ctrl.selectedReport.uuid}"
												ng-click="ctrl.selectFolderItem(item)">
											<td>
												<a ng-click="ctrl.actionItem(item.uuid, item.type, 'edit')">{{item.name}}</a>
												<span class="fa fa-info-circle fa-right-pad text-muted" uib-tooltip="{{item.description}}" ng-show="item.description"></span>
											</td>
											<td>{{item.lastModified | date:'dd-MMM-yyyy HH:mm:ss'}}</td>
											<td><span class="fa fa-right-pad {{item.type | itemTypeIdToIcon}} text-muted"></span>{{item.type | itemTypeIdToString}}</td>
											<td>
												<div class="child-to-show">
													<button type="button" class="btn btn-primary btn-xs" ng-click="ctrl.run(item)">Queue</button>
													<span uib-dropdown dropdown-append-to-body>
														<button type="button" class="btn btn-xs btn-default" uib-dropdown-toggle>...</button>
														<ul uib-dropdown-menu class="dropdown-menu-right" style="cursor: pointer">
															<li class="disabled"><a href="#">Rename</a></li>
															<li><a ng-click="ctrl.deleteItem(item)">Delete</a></li>
															<li role="separator" class="divider"></li>
															<li><a ng-click="ctrl.cutItem(item)">Cut</a></li>
															<li><a ng-click="ctrl.copyItem(item)">Copy</a></li>
														</ul>
													</span>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							</div>
						</div>
						<div class="row module-footer">
							<div class="col-md-4 zero-pad">
								<div class="bordered-box scroll-box-300">
									<div class="table">
										<table class="table table-striped table-condensed">
											<thead>
												<tr>
													<th class="col-md-7">Date</th>
													<th class="col-md-5">Status</th>
												</tr>
											</thead>
											<tbody>
												<tr class="hover-box" style="cursor: pointer"
														ng-repeat="schedule in ctrl.selectedReportSchedules"
														ng-class="{'selection': schedule.uuid == ctrl.selectedSchedule.uuid}"
														ng-click="ctrl.selectSchedule(schedule)">
													<td>{{ schedule.date | date:'dd-MMM-yyyy HH:mm:ss' }}</td>
													<td>
														<span class="text-muted fa fa-clock-o" ng-show="schedule.status == 'Scheduled'"></span>
														<span class="text-muted fa fa-check" ng-hide="schedule.status == 'Scheduled'"></span>
														{{ schedule.status }}
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
							<div class="col-md-8 zero-pad">
								<div class="bordered-box scroll-box-300">
									<uib-tabset>
										<uib-tab index="0" heading="Parameters">
											<div class="panel-body">
												<div class="row">
													<label class="col-md-3">Baseline date :</label>
													<p class="col-md-9">{{ ctrl.selectedSchedule.parameters.baselineDate | date:'dd-MMM-yyyy' }}</p>
												</div>
												<div class="row">
													<label class="col-md-3">Patient type : </label>
													<p class="col-md-9">{{ ctrl.selectedSchedule.parameters.patientType }}</p>
												</div>
												<div class="row">
													<label class="col-md-3">Patient status : </label>
													<p class="col-md-9">{{ ctrl.selectedSchedule.parameters.patientStatus }}</p>
												</div>
											</div>
										</uib-tab>
										<uib-tab index="1" heading="Results">
											<div class="panel-body">
												<div class="row">
													<label class="col-md-3">Population count :</label>
													<p class="col-md-9">{{ ctrl.selectedScheduleResults.populationCount | number }}</p>
												</div>

												<div ui-tree data-nodrop-enabled="true" data-nodrag  id="tree-root">
													<ol ui-tree-nodes ng-model="ctrl.selectedScheduleResults.queryResults">
														<li ng-repeat="node in ctrl.selectedScheduleResults.queryResults" ui-tree-node ng-include="'result_template.html'"></li>
													</ol>
												</div>

											</div>
										</uib-tab>
									</uib-tabset>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/ng-template" id="result_template.html">
	<div ui-tree-handle class="tree-node tree-node-content" style="cursor:pointer">
		<div class="row">
			<div class="col-md-6">
				<span	ng-if="!node.childQueries" data-nodrag class="fa fa-sm fa-blank text-muted"></span>
				<span ng-if="node.childQueries" data-nodrag	class="fa fa-sm text-muted"
							ng-class="{'fa-chevron-right': !node.isExpanded,'fa-chevron-down': node.isExpanded}"
							ng-click="node.isExpanded = !node.isExpanded"></span>
				<span>{{node.name}}</span>
				<span class="fa fa-info-circle fa-right-pad text-muted" uib-tooltip="{{node.description}}" ng-show="node.description"></span>
			</div>
			<div class="col-md-3">
				<span>{{node.resultCount | number }}</span>
			</div>
			<div class="col-md-3">
				<span>{{ node.percentageOfParent }}</span>
			</div>
		</div>
	</div>
	<ol ui-tree-nodes ng-model="node.childQueries" ng-show="node.isExpanded">
		<li ui-tree-node ng-repeat="node in node.childQueries" ng-include="'result_template.html'">
		</li>
	</ol>
</script>
