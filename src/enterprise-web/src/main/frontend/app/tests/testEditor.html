<style>
	.form-group {
		margin-bottom: 0px;
	}
</style>

<div class="modal-header">
	<button type="button" class="close" (click)="cancel()" aria-hidden="true">&times;</button>
	<h4 class="modal-title">{{title}}</h4>
</div>
<div class="modal-body">
	<form role="form">
		<div class='row' *ngIf="type=='3'">
			<div class="col-xs-12">
				<div class="form-group">
					<label>Select the Feature or Function to Test Against</label>
					<select class="form-control" [(ngModel)]="testRuleId" name="testRuleId">
						<option *ngFor="let rule of rules" value="{{rule.value}}">{{rule.displayName}}</option>
					</select>
				</div>
			</div>
		</div>
		<div class='row' *ngIf="type=='3'" style="margin-top: 15px;margin-bottom: 15px;">
			<div class="col-xs-12">
				<div class="form-group">
					<div class="input-group">
						<span>Test against a Concept?</span>&nbsp;&nbsp;
						<input id="conceptTest" type="radio" name="conceptTest" [(ngModel)]="testType" value="concept" name="conceptTest">
						&nbsp;
						<span>or a Value?</span>&nbsp;&nbsp;
						<input id="valueTest" type="radio" name="valueTest" [(ngModel)]="testType" value="value" name="valueTest">
						&nbsp;
						<span>or a Date?</span>&nbsp;&nbsp;
						<input id="dateTest" type="radio" name="dateTest" [(ngModel)]="testType" value="date" name="dateTest">
					</div>
				</div>
			</div>
		</div>

		<div class='row' *ngIf="testType=='value'">
			<div class="col-xs-12">
				<div class="form-group">
					<div class="input-group">
						<span style="font-weight:bold">Test is <span style="font-weight:bold;color:blue">"{{getRuleName(testRuleId)}}"</span></span>
						<b> >= </b> <input id="testValueFrom" style="width:100px" type="text" (blur)="testValueFromChange(testValueFrom)" name="testValueFrom" [(ngModel)]="testValueFrom">
						<b> <= </b> <input id="testValueTo" style="width:100px" type="text" (blur)="testValueToChange(testValueTo)" name="testValueTo" [(ngModel)]="testValueTo">
						<a style='margin-left: 20px' class="queryLink" (click)="removeFilter('value')"><i class="fa fa-times"></i> Remove filter</a>
					</div>

				</div>
			</div>
		</div>

		<div class='row' *ngIf="testType=='concept' || type=='1' ">
			<div class="col-xs-12">
				<div class="form-group">
					<label>
						<a class="queryLink" (click)="showCodePicker()"><i class="fa fa-search"></i> Select Concept(s)</a>
						<a style='margin-left: 20px' class="queryLink" (click)="showCodeSetPicker()"><i class="fa fa-tags"></i> Select Code Set</a>
					</label>

					<div *ngIf="type=='1'" style="cursor: pointer; height:auto; overflow-y:scroll; min-height: 30px; max-height: 150px;" >
						<table border=1 frame=void rules=rows style="border-color: silver; margin-top:10px;margin-left:15px;width:830px">
							<tr *ngIf="showConceptResults">
								<th style="width: 150px">Data Source</th>
								<th style="width: 200px">Parent Concept</th>
								<th style="width: 200px">Concept Term</th>
								<th style="width: 140px">Value >=</th>
								<th style="width: 140px">Value <=</th>
							</tr>
							<tr style="height:40px" *ngFor="let selection of codeSelection; let isLast=last">
								<td style="color:black;font-size:12px">
									{{ selection.baseType }}
								</td>
								<td *ngIf="selection.parentType!=selection.baseType"  style="color:black;font-size:12px">
									{{ selection.parentType }}
								</td>
								<td *ngIf="selection.parentType==selection.baseType">

								</td>
								<td style="color:black;font-size:12px">
									{{ selection.term.split("(")[0] }}
								</td>
								<td *ngIf="selection.dataType=='8'||selection.dataType=='13'||selection.baseType=='Observation'">
									<input type="text" style="width:100px;background: lightyellow" [(ngModel)]="selection.valueFrom" [ngModelOptions]="{standalone: true}"><span style="font-size: 10px;"> {{selection.units}}</span>
								</td>
								<td *ngIf="selection.dataType=='13'||selection.baseType=='Observation'">
									<input type="text" style="width:100px;background: lightyellow" [(ngModel)]="selection.valueTo" [ngModelOptions]="{standalone: true}"><span style="font-size: 10px;"> {{selection.units}}</span>
								</td>
								<td *ngIf="selection.dataType=='2'||selection.dataType=='14'">
									<input type="date" style="width:140px;background: lightyellow" [(ngModel)]="selection.valueFrom" [ngModelOptions]="{standalone: true}">
								</td>
								<td *ngIf="selection.dataType=='14'">
									<input type="date" style="width:140px;background: lightyellow" [(ngModel)]="selection.valueTo" [ngModelOptions]="{standalone: true}">
								</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</div>

		<div class='row' *ngIf="testType=='concept'" style="margin-top: 15px">
			<div class="col-xs-12">
				<div class="form-group">
					<div class="input-group">
						<span style="font-weight:bold">Test is <span style="font-weight:bold;color:blue">"{{getRuleName(testRuleId)}}"</span></span>
						<b> in the concept list:</b>
						<div>
							<span *ngFor="let selection of codeSelection">
								{{ selection.term.split("(")[0] }}
								<span *ngIf="!this.$last">  |  </span>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class='row' *ngIf="type=='1' && problemEditor" style="margin-top:10px">

			<div class="col-xs-12" style="margin-left:16px;">
				<div class="form-group">
					<div style="float: left;font-weight: bold;">
						Problem?
					</div>
					<div class="input-group" style="margin-left:10px; float: left;">
						<input type="checkbox" [(ngModel)]="problem" name="problem" (change)="problemChange($event)">
					</div>
				</div>
			</div>
		</div>
		<div class='row' *ngIf="type=='1' && activeEditor" style="margin-top:10px">

			<div class="col-xs-12" style="margin-left:16px;">
				<div class="form-group">
					<div style="float: left;font-weight: bold;">
						Active Medication?
					</div>
					<div class="input-group" style="margin-left:10px; float: left;">
						<input type="checkbox" [(ngModel)]="active" name="active" (change)="activeChange($event)">
					</div>
				</div>
			</div>
		</div>
		<div class='row' *ngIf="type=='1' && authTypeEditor" style="margin-top:15px">

			<div class="col-xs-12" style="margin-left:16px;">
				<div class="form-group">
					<div style="float: left;font-weight: bold;">
						Acute
					</div>
					<div class="input-group" style="margin-left:10px; float: left;">
						<input type="checkbox" [(ngModel)]="acute" name="acute" (change)="acuteChange($event)">
					</div>
					<div style="margin-left:30px;float: left;font-weight: bold;">
						Repeat
					</div>
					<div class="input-group" style="margin-left:10px; float: left;">
						<input type="checkbox" [(ngModel)]="repeat" name="repeat" (change)="repeatChange($event)">
					</div>
					<div style="margin-left:30px;float: left;font-weight: bold;">
						Repeat Dispensing
					</div>
					<div class="input-group" style="margin-left:10px; float: left;">
						<input type="checkbox" [(ngModel)]="repeatDispensing" name="repeatDispensing" (change)="repeatDispensingChange($event)">
					</div>
					<div style="margin-left:30px;float: left;font-weight: bold;">
						Automatic
					</div>
					<div class="input-group" style="margin-left:10px; float: left;">
						<input type="checkbox" [(ngModel)]="automatic" name="automatic" (change)="automaticChange($event)">
					</div>
				</div>
			</div>
		</div>

		<div class='row' *ngIf="testType=='date'" style="margin-top: 15px">
			<div class="col-xs-12">
				<div class="form-group">
					<div class="input-group">
						<span style="font-weight:bold">Test is <span style="font-weight:bold;color:blue">"{{getRuleName(testRuleId)}}"</span></span>
						<b> within the following date range:</b>
					</div>
				</div>
			</div>
		</div>

		<div class='row' *ngIf="testType=='date' || (dateEditor&&type=='1')" style="margin-left: 1px; margin-top: 15px;">

			<div class="col-xs-12">
				<div class="form-group">
					<div class="input-group">
						<span for="relative">Use relative dates</span>&nbsp;&nbsp;
						<input id="relative" type="radio" name="datetype" [(ngModel)]="datetype" value="relative" name="dateRelative">
						&nbsp;
						<span for="absolute">or absolute dates</span>&nbsp;&nbsp;
						<input id="absolute" type="radio" name="datetype" [(ngModel)]="datetype" value="absolute" name="dateAbsolute">
						<a style='margin-left: 20px' class="queryLink" (click)="removeFilter('date')"><i class="fa fa-times"></i> Remove filter</a>
					</div>
				</div>
			</div>
		</div>
		<div class='row' *ngIf="testType=='date' || (dateEditor&&type=='1')" style="margin-left: 1px;">
			<div class="col-xs-6">
				<div class="form-group">
					<span *ngIf="datetype == 'absolute'">From (>=):</span>
					<p class="input-group" *ngIf="datetype == 'absolute'">
						<input type="date" class="form-control" [(ngModel)]="filterDateFrom" name="dateFrom">
					</p>
					<span *ngIf="datetype == 'relative'">From (>=):</span>
					<p class="input-group" *ngIf="datetype == 'relative'">
						<input type="text" class="form-control" style="width:80px;margin-right:10px" placeholder="no." [(ngModel)]="filterDateFromRelativeValue" name="dateFromRelativeValue">
						<select class="form-control" style="width:100px" [(ngModel)]="filterDateFromRelativePeriod" name="dateFromRelativePeriod">
							<option *ngFor="let period of periods" value="{{period}}">{{period}}</option>
						</select>&nbsp;&nbsp;before the
						<select class="form-control" [(ngModel)]="testDateFromRuleId" name="testDateFromRuleId" >
							<option *ngFor="let rule of rules" value="{{rule.value}}">{{rule.displayName}}</option>
						</select>
					</p>
				</div>
			</div>
			<div class="col-xs-6">
				<div class="form-group">
					<span *ngIf="datetype == 'absolute'">To (<=):</span>
					<p class="input-group" *ngIf="datetype == 'absolute'">
						<input type="date" class="form-control" [(ngModel)]="filterDateTo" name="dateTo">
					</p>
					<span *ngIf="datetype == 'relative'">To (<=):</span>
					<p class="input-group" *ngIf="datetype == 'relative'">
						<input type="text" class="form-control" style="width:80px;margin-right:10px" placeholder="no." [(ngModel)]="filterDateToRelativeValue" name="dateToRelativeValue">
						<select class="form-control" style="width:100px" [(ngModel)]="filterDateToRelativePeriod" name="dateToRelativePeriod">
							<option *ngFor="let period of periods" value="{{period}}">{{period}}</option>
						</select>&nbsp;&nbsp;after the
						<select class="form-control" [(ngModel)]="testDateToRuleId" name="testDateToRuleId" >
							<option *ngFor="let rule of rules" value="{{rule.value}}">{{rule.displayName}}</option>
						</select>
					</p>
				</div>
			</div>
		</div>
		<div *ngIf="type=='1' && showConceptResults" style="margin-top: 10px;">
			<a class="queryLink" (click)="toggleRestriction()"><i class="fa fa-sort-amount-asc"></i> Keep Entries</a>
		</div>
		<div class='row' *ngIf="showRestriction" style="margin-left:2px;"><br/>
			<div class="col-xs-3">
				<div class="form-group">
					<label>Keep Entries</label>
					<select class="form-control" [(ngModel)]="restriction" (ngModelChange)="restrictionChange(restriction)" name="restriction">
						<option *ngFor="let restriction of restrictions" value="{{restriction}}">{{restriction}}</option>
					</select>
				</div>
			</div>
			<div class="col-xs-2">
				<div class="form-group">
					<label>How Many?</label>
					<input type="text" class="form-control" [(ngModel)]="restrictionCount" placeholder="1" (blur)="restrictionChange(restrictionCount)" name="restrictionCount">
				</div>
			</div>
			<div class="col-xs-2">
				<div class="form-group">
					<label>Field Prefix:</label>
					<input type="text" class="form-control" [(ngModel)]="fieldPrefix" (blur)="restrictionChange(fieldPrefix)" name="fieldPrefix">
				</div>
			</div>
			<div class="col-xs-5">
				<div class="form-group">
					<label>Keep the Fields:</label>
					<select multiple class="form-control" style="width:200px" (change)="setSelectedFields($event.target)">
						<option *ngFor="let field of keepFields" value="{{field}}">{{field}}</option>
					</select>
				</div>
			</div>

			<a class="queryLink" (click)="removeFilter('restriction')"><i class="fa fa-times"></i> Remove Entries</a>
		</div>
		<br/>
	</form>

</div>
<div class="modal-footer">
	<button type="button" class="btn btn-default"
			(click)="cancel()">Cancel</button>
	<button type="button" class="btn btn-primary"
			(click)="save();">Ok</button>
</div>
