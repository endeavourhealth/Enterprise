<!DOCTYPE html>
<html>
<head>

	<meta charset="UTF-8"> 

	<title>Enterprise REST Test</title>

	<style>
		body {background-color:lightgrey; }
		input {width: 300px;}
	</style>

<script>


	function post(url, params)
	{
		//testing git

		var para = appendHeadingToResults(url);

		if (typeof(params)!='undefined')
		{
			var jsonStr = JSON.stringify(params);
			appendResult(para, "request", jsonStr);
		}
	
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.DisableHeaderCheck = true;

		xmlhttp.onreadystatechange = function()
		{
			if (xmlhttp.readyState == 4) //request complete
			{
				var status = xmlhttp.status;
				var statusText = xmlhttp.statusText;
				appendResult(para, "response status", status + " " + statusText);

				var response = xmlhttp.responseText;
				appendResult(para, "response", response);

				scrollToEnd();
			}
		};

		xmlhttp.open("POST", url, true);

		xmlhttp.setRequestHeader('Accept', 'application/json');
		xmlhttp.setRequestHeader('Content-Type', 'application/json; charset=utf-8');
		if(typeof(params)!='undefined')
		{
			xmlhttp.setRequestHeader('Content-Length', params.length);
		}

		//if (params == null)
		if(typeof(params)=='undefined')
		{
			xmlhttp.send();
		}
		else
		{
			var jsonStr = JSON.stringify(params);
			xmlhttp.send(jsonStr);
		}


	}

	function get(url, params)
	{
		var para = appendHeadingToResults(url);

		if (typeof(params)!='undefined')
		{
			appendResult(para, "params", params);

			url += '?' + params;
		}

		var xmlhttp = new XMLHttpRequest();

		xmlhttp.onreadystatechange = function() {
		
			if (xmlhttp.readyState == 4) //request complete
			{
				var status = xmlhttp.status;
				var statusText = xmlhttp.statusText;
				appendResult(para, "response status", status + " " + statusText);
			
				var response = xmlhttp.responseText;
				appendResult(para, "response", response);
	   		}
		};

		xmlhttp.open("GET", url, true);
		xmlhttp.setRequestHeader('Accept', 'application/json');

		xmlhttp.send();

		scrollToEnd();
	}

	function appendHeadingToResults(title)
	{
		var d = new Date();
		var titleWithTime = "" + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds() + " -> " + title;

		var para = document.createElement("p");
		var heading = document.createElement("strong");
		var textNode = document.createTextNode(titleWithTime);
		var resultsElement = document.getElementById("results");

		heading.appendChild(textNode);
		para.appendChild(heading);
		resultsElement.appendChild(para);

		return para;
	}

	function appendResult(para, name, value)
	{
		var brElement = document.createElement("br");
		para.appendChild(brElement);

		var nameTextNode = document.createTextNode(name + ": ");
		para.appendChild(nameTextNode);

		var codeElement = document.createElement("code");
		para.appendChild(codeElement);

		var valueArr = value.split("{");
		if (valueArr.length == 1) {
			var valueTextNode = document.createTextNode(value);
			codeElement.appendChild(valueTextNode);
		} else {
			for (i = 1; i < valueArr.length; i++) {
				if (i>1) {
					brElement = document.createElement("br");
					codeElement.appendChild(brElement);
				}

				var valueTextNode = document.createTextNode("{" + valueArr[i]);
				codeElement.appendChild(valueTextNode);
			}
		}
	}
	/*function appendResult(para, name, value)
	{
		var brElement = document.createElement("br");
		var codeElement = document.createElement("code");
		var nameTextNode = document.createTextNode(name + ": ");
		var valueTextNode = document.createTextNode(value);

		codeElement.appendChild(valueTextNode);

		para.appendChild(brElement);
		para.appendChild(nameTextNode);
		para.appendChild(codeElement);
	}*/

	function scrollToEnd()
	{
		window.scrollTo(0,document.body.scrollHeight);
	}




</script>

</head>

<body>

<h3>/api/security/login</h3>

	Username: <input type="text" id="username" value="admin@email">
	<br/>
	Password: <input type="text" id="password" value="test">
	<br/>
	<button type="button" onclick="performLogin()">Submit</button>

	<script>
		function performLogin() {

			var usernameStr = document.getElementById('username').value;
			var passwordStr = document.getElementById('password').value;

			var params = {username:usernameStr, password:passwordStr};
			var jsonStr = JSON.stringify(params);

			post('/api/security/login/', params);

		}
	</script>

<hr/>
<h3>/api/security/selectOrganisation</h3>

	Organisation UUID: <input type="text" id="uuid">
	<br/>
	<button type="button" onclick="selectOrganisation()">Submit</button>

	<script>
		function selectOrganisation() {

			var orgUuid = document.getElementById('uuid').value;
			var params = {uuid:orgUuid};

			post('/api/security/selectOrganisation/', params);
	
		}
	</script>

<hr/>
<h3>/api/security/logoff</h3>

	<button type="button" onclick="logoff()">Submit</button>

	<script>
		function logoff() {

			post('/api/security/logoff/');
	
		}
	</script>

<hr/>
<h3>/api/security/setPasswordFromInviteEmail</h3>

	Token: <input type="text" id="inviteToken">
	<br/>
	Password: <input type="text" id="invitePassword">
	<br/>
	<button type="button" onclick="setPasswordFromInvite()">Submit</button>

	<script>
		function setPasswordFromInvite() {

			var emailToken = document.getElementById('inviteToken').value;
			var newPassword = document.getElementById('invitePassword').value;

			var params = {token:emailToken, password:newPassword};

			post('/api/security/setPasswordFromInviteEmail/', params);
	
		}
	</script>

<hr/>
<h3>/api/admin/getUsers</h3>

	<button type="button" onclick="getUsers()">Submit</button>

	<script>
		function getUsers() {

			get('/api/admin/getUsers/');
	
		}
	</script>

<hr/>
<h3>/api/admin/saveUser</h3>

	User UUID: <input type="text" id="saveUserUuid">(leave blank to create a new user)
	<br/>
	Email: <input type="text" id="saveUserEmail">
	<br/>
	New password: <input type="text" id="saveUserPassword">
	<br/>
	Title: <input type="text" id="saveUserTitle">
	<br/>
	Forename: <input type="text" id="saveUserForename">
	<br/>
	Surname: <input type="text" id="saveUserSurname">
	<br/>
	Permissions:
	<select id="saveUserPermissions">
		<option value="0"></option>
		<option value="1">User</option>
		<option value="2">Admin</option>
	</select>
	<br/>
	Super user: <input type="checkbox" id="saveUserSuperUser">
	<br/>

	<button type="button" onclick="saveUser()">Submit</button>

	<script>
			function saveUser() {

				var params = {};

				var s = document.getElementById('saveUserUuid').value;
				if (s.length > 0)
				{
					params["uuid"] = s;
				}

				s = document.getElementById('saveUserEmail').value;
				if (s.length > 0)
				{
					params["username"] = s;
				}

				s = document.getElementById('saveUserPassword').value;
				if (s.length > 0)
				{
					params["password"] = s;
				}

				s = document.getElementById('saveUserTitle').value;
				if (s.length > 0) {
					params["title"] = s;
				}

				s = document.getElementById('saveUserForename').value;
				if (s.length > 0) {
					params["forename"] = s;
				}

				s = document.getElementById('saveUserSurname').value;
				if (s.length > 0) {
					params["surname"] = s;
				}

				var s = document.getElementById('saveUserPermissions').value;
				if (s.length > 0)
				{
					if (s == '1') {
						params["admin"] = false;
					} else if (s == '2') {
						params["admin"] = true;
					}
				}

				if (document.getElementById("saveUserSuperUser").checked)
				{
					params["superUser"] = true;
				}

				post('/api/admin/saveUser/', params);

			}
		</script>

<hr/>
<h3>/api/admin/deleteUser</h3>

	User UUID: <input type="text" id="deleteUserUuid">
	<br/>
	<button type="button" onclick="deleteUser()">Submit</button>


	<script>
			function deleteUser() {

				var s = document.getElementById('deleteUserUuid').value;
				var params = {uuid:s};

				post('/api/admin/deleteUser/', params);
			}
		</script>




<hr/>
<h3>/api/admin/resendInviteEmail</h3>

	User UUID: <input type="text" id="resendInviteUuid">
	<br/>
	<button type="button" onclick="resendInviteEmail()">Submit</button>

	<script>
		function resendInviteEmail() {

			var s = document.getElementById('resendInviteUuid').value;
			var params = {uuid:s};
			post('/api/admin/resendInviteEmail/', params);
		}
	</script>

<hr/>
<h3>/api/admin/saveOrganisation</h3>

	Organisation UUID: <input type="text" id="saveOrganisationUuid">(Leave blank to create new one)
	<br/>
	Organisation name: <input type="text" id="saveOrganisationName">
	<br/>
	National ID: <input type="text" id="saveOrganisationId">
	<br/>
	<button type="button" onclick="saveOrganisation()">Submit</button>

	<script>
			function saveOrganisation() {

				var params = {};

				var s = document.getElementById('saveOrganisationUuid').value;
				if (s.length > 0)
				{
					params["uuid"] = s;
				}

				s = document.getElementById('saveOrganisationName').value;
				if (s.length > 0)
				{
					params["name"] = s;
				}

				s = document.getElementById('saveOrganisationId').value;
				if (s.length > 0)
				{
					params["nationalId"] = s;
				}

				post('/api/admin/saveOrganisation/', params);

			}
		</script>


<hr/>
<h3>/api/folder/saveFolder</h3>

	Folder UUID: <input type="text" id="saveFolderUuid">(leave blank to create a new folder)
	<br/>
	Folder name: <input type="text" id="saveFolderName">
	<br/>
	Folder type:
	<select id="saveFolderType">
		<option value="1">Library</option>
		<option value="2">Reports</option>
	</select>
	<br/>
	Parent folder UUID: <input type="text" id="saveFolderParentUuid">
	<br/>
	<button type="button" onclick="saveFolder()">Submit</button>


	<script>
		function saveFolder() {

			var params = {};

			var s = document.getElementById('saveFolderUuid').value;
			if (s.length > 0)
			{
				params["uuid"] = s;
			}
			s = document.getElementById('saveFolderName').value;
			if (s.length > 0)
			{
				params["folderName"] = s;
			}
			s = document.getElementById('saveFolderType').value;
			if (s.length > 0)
			{
				params["folderType"] = s;
			}
			s = document.getElementById('saveFolderParentUuid').value;
			if (s.length > 0)
			{
				params["parentFolderUuid"] = s;
			}

			post('/api/folder/saveFolder/', params);
		}
	</script>

<hr/>
<h3>/api/folder/deleteFolder</h3>

	Folder UUID: <input type="text" id="deleteFolderUuid">
	<br/>
	<button type="button" onclick="deleteFolder()">Submit</button>


	<script>
		function deleteFolder() {

			var s = document.getElementById('deleteFolderUuid').value;

			var params = {uuid:s};
			post('/api/folder/deleteFolder/', params);

		}
	</script>


<hr/>
<h3>/api/folder/getFolders</h3>

	Folder type <select id="getFoldersType">
		<option value="1">Library</option>
		<option value="2">Reports</option>
	</select>
	<br/>
	Parent folder UUID: <input type="text" id="getFoldersParentUuid">
	<br/>
	<button type="button" onclick="getFolders()">Submit</button>

	<script>
		function getFolders() {

			var s = document.getElementById('getFoldersType').value;
			var params = 'folderType=' + s;

			s = document.getElementById('getFoldersParentUuid').value;
			if (s.length > 0)
			{
				params += '&parentUuid=' + s;
			}

			get('/api/folder/getFolders', params);
		}
	</script>


<hr/>
<h3>/api/folder/getFolderContents</h3>

	Folder UUID: <input type="text" id="getFolderContentsUuid">
	<br/>
	<button type="button" onclick="getFolderContents()">Submit</button>

	<script>
		function getFolderContents() {

			var s = document.getElementById('getFolderContentsUuid').value;
			var params = 'folderUuid=' + s;

			get('/api/folder/getFolderContents', params);
		}
	</script>


<hr/>
<h3>/api/report/getReport</h3>

	UUID: <input type="text" id="getReportUuid">
	<br/>
	<button type="button" onclick="getReport()">Submit</button>

	<script>
		function getReport() {

			var s = document.getElementById('getReportUuid').value;

			get('/api/report/getReport', 'uuid=' + s);
		}
	</script>

<hr/>
<h3>/api/report/getReportSchedules</h3>

	Report UUID: <input type="text" id="getReportSchedulesUuid">
	<br/>
	Count: <input type="number" min="1" value="5" id="getReportSchedulesCount">
	<br/>
	<button type="button" onclick="getReportSchedules()">Submit</button>

	<script>
		function getReportSchedules() {

			var s = document.getElementById('getReportSchedulesUuid').value;
			var s2 = document.getElementById('getReportSchedulesCount').value;

			get('/api/report/getReportSchedules', 'uuid=' + s + '&count=' + s2);
		}
	</script>


<hr/>
<h3>/api/report/getScheduleResults</h3>

	Schedule UUID: <input type="text" id="getScheduleResultsUuid">
	<br/>
	Filter by ODS code: <input type="text" id="getScheduleResultsOdsCode"> (leave blank to get all results)
	<br/>
	<button type="button" onclick="getScheduleResults()">Submit</button>

	<script>
		function getScheduleResults() {

			var s = document.getElementById('getScheduleResultsUuid').value;
			var ods = document.getElementById('getScheduleResultsOdsCode').value;
			if (ods.length > 0) {
				get('/api/report/getScheduleResults', 'uuid=' + s + '&organisation=' + ods);
			} else {
				get('/api/report/getScheduleResults', 'uuid=' + s);
			}
		}
	</script>

<hr/>
<h3>/api/report/saveReport</h3>


	UUID: <input type="text" id="saveReportUuid">(leave blank to create a new one)
	<br/>
	Name: <input type="text" id="saveReportName">
	<br/>
	Description: <input type="text" id="saveReportDescription">
	<br/>
	Query1: <input type="text" id="saveReportQuery1Uuid">
	<br/>
	Query1: <input type="text" id="saveReportQuery2Uuid">
	<br/>
	ListOutput1: <input type="text" id="saveReportListOutput1Uuid">
	<br/>
	ListOutput2: <input type="text" id="saveReportListOutput2Uuid">
	<br/>
	Folder UUID: <input type="text" id="saveReportFolderUuid">
	<br/>
	<button type="button" onclick="saveReport()">Submit</button>
	
	<script>
		function saveReport() {

			var params = {};

			var s = document.getElementById('saveReportUuid').value;
			if (s.length > 0)
			{
				params['uuid'] = s;
			}

			s = document.getElementById('saveReportName').value;
			if (s.length > 0)
			{
				params['name'] = s;
			}

			s = document.getElementById('saveReportDescription').value;
			if (s.length > 0)
			{
				params['description'] = s;
			}

			var reportItems = [];
			params['reportItem'] = reportItems;

			s = document.getElementById('saveReportQuery1Uuid').value;
			if (s.length > 0)
			{
				reportItems[reportItems.length] = {'queryLibraryItemUuid': s};
			}

			s = document.getElementById('saveReportQuery2Uuid').value;
			if (s.length > 0)
			{
				reportItems[reportItems.length] = {'queryLibraryItemUuid': s};
			}

			s = document.getElementById('saveReportListOutput1Uuid').value;
			if (s.length > 0)
			{
				reportItems[reportItems.length] = {'listReportLibraryItemUuid': s};
			}

			s = document.getElementById('saveReportListOutput2Uuid').value;
			if (s.length > 0)
			{
				reportItems[reportItems.length] = {'listReportLibraryItemUuid': s};
			}

			s = document.getElementById('saveReportFolderUuid').value;
			if (s.length > 0)
			{
				params['folderUuid'] = s;
			}

			post('/api/report/saveReport/', params);

		}
	</script>

<hr/>
<h3>/api/report/scheduleReport</h3>
	
	
	Report UUID: <input type="text" id="scheduleReportUuid">
	<br/>
	Baseline date: <input type="text" id="scheduleReportDate">
	<br/>
	Patient type:
	<select id="scheduleReportPatientType">
		<option value="regular">Regular</option>
		<option value="nonRegular">Non-Regular</option>
		<option value="all">All</option>
	</select>
	<br/>
	Patient status:
	<select id="scheduleReportPatientStatus">
		<option value="active">Active</option>
		<option value="all">All</option>
	</select>
	<br/>
	Organisation1: <input type="text" id="scheduleReportOrganisation1">
	<br/>
	Organisation2: <input type="text" id="scheduleReportOrganisation2">
	<br/>
	<button type="button" onclick="scheduleReport()">Submit</button>

	<script>
		function scheduleReport() {

			var params = {};

			var s = document.getElementById('scheduleReportUuid').value;
			if (s.length > 0)
			{
				params['reportUuid'] = s;
			}

			s = document.getElementById('scheduleReportDate').value;
			if (s.length > 0)
			{
				params['baselineDate'] = s;
			}

			s = document.getElementById('scheduleReportPatientType').value;
			if (s.length > 0)
			{
				params['patientType'] = s;
			}

			s = document.getElementById('scheduleReportPatientStatus').value;
			if (s.length > 0)
			{
				params['patientStatus'] = s;
			}

			var organisations = [];
			params['organisation'] = organisations;

			s = document.getElementById('scheduleReportOrganisation1').value;
			if (s.length > 0)
			{
				organisations[organisations.length] = s;
			}

			s = document.getElementById('scheduleReportOrganisation2').value;
			if (s.length > 0)
			{
				organisations[organisations.length] = s;
			}

			post('/api/report/scheduleReport/', params);

		}
	</script>

<hr/>
<h3>/api/report/deleteReport</h3>

	UUID: <input type="text" id="deleteReportUuid">
	<br/>
	<button type="button" onclick="deleteReport()">Submit</button>

	<script>
		function deleteReport() {

			var s = document.getElementById('deleteReportUuid').value;
			var params = {uuid:s};

			post('/api/report/deleteReport/', params);

		}
	</script>

<hr/>
<h3>/api/library/getLibraryItem</h3>

	UUID: <input type="text" id="getLibraryUuid">
	<br/>
	<button type="button" onclick="getLibrary()">Submit</button>

	<script>
		function getLibrary() {

			var s = document.getElementById('getLibraryUuid').value;

			get('/api/library/getLibraryItem', 'uuid=' + s);
		}
	</script>

<hr/>
<h3>/api/library/saveLibraryItem</h3>

	
	UUID: <input type="text" id="saveLibraryUuid">(leave blank to create a new one)
	<br/>
	Name: <input type="text" id="saveLibraryName">
	<br/>
	Description: <input type="text" id="saveLibraryDescription">
	<br/>
	XML Content: <input type="text" id="saveLibraryXml">
	<br/>
	Is Deleted: <input type="checkbox" id="saveLibraryDeleted">
	<br/>
	Folder UUID: <input type="text" id="saveLibraryFolderUuid">
	<br/>
	<button type="button" onclick="saveLibrary()">Submit</button>
	
	<script>
		function saveLibrary() {

			var params = {};

			var s = document.getElementById('saveLibraryUuid').value;
			if (s.length > 0)
			{
				params['uuid'] = s;
			}

			s = document.getElementById('saveLibraryName').value;
			if (s.length > 0)
			{
				params['name'] = s;
			}

			s = document.getElementById('saveLibraryDescription').value;
			if (s.length > 0)
			{
				params['description'] = s;
			}

			s = document.getElementById('saveLibraryXml').value;
			if (s.length > 0)
			{
				params['xmlContent'] = s;
			}

			if (document.getElementById("saveLibraryDeleted").checked)
			{
				params['isDeleted'] = 'true';
			}

			s = document.getElementById('saveLibraryFolderUuid').value;
			if (s.length > 0)
			{
				params['folderUuid'] = s;
			}

			post('/api/library/saveLibraryItem/', params);

		}
	</script>

<hr/>
<h3>/api/library/deleteLibraryItem</h3>

	UUID: <input type="text" id="deleteLibraryUuid">
	<br/>
	<button type="button" onclick="deleteLibrary()">Submit</button>

	<script>
		function deleteLibrary() {

			var s = document.getElementById('deleteLibraryUuid').value;
			var params = {uuid:s};

			post('/api/library/deleteLibraryItem/', params);

		}
	</script>

<hr/>
<h3>/api/library/getLibraryItemNamesForReport</h3>

	UUID: <input type="text" id="getLibraryItemNamesForReportUuid">
	<br/>
	<button type="button" onclick="getLibraryItemNamesForReport()">Submit</button>

	<script>
		function getLibraryItemNamesForReport() {

			var s = document.getElementById('getLibraryItemNamesForReportUuid').value;

			get('/api/library/getLibraryItemNamesForReport', 'uuid=' + s);
		}
	</script>

<hr/>
<h3>/api/dashboard/getRecentDocuments</h3>

	Count: <input type="number" min="1" value="5" id="getRecentDocumentsCount">
	<br/>
	<button type="button" onclick="getRecentDocuments()">Submit</button>

	<script>
		function getRecentDocuments() {
			var s = document.getElementById('getRecentDocumentsCount').value;
			get('/api/dashboard/getRecentDocuments', 'count=' + s);
		}
	</script>

<hr/>
<h3>/api/dashboard/getReportActivity</h3>

	Count: <input type="number" min="1" value="5" id="getReportActivityCount">
	<br/>
	<button type="button" onclick="getReportActivity()">Submit</button>

	<script>
		function getReportActivity() {
			var s = document.getElementById('getReportActivityCount').value;
			get('/api/dashboard/getReportActivity', 'count=' + s);
		}
	</script>

<hr/>
<h3>/api/dashboard/getEngineHistory</h3>

	Count: <input type="number" min="1" value="5" id="getEngineHistoryCount">
	<br/>
	<button type="button" onclick="getEngineHistory()">Submit</button>

	<script>
		function getEngineHistory() {
			var s = document.getElementById('getEngineHistoryCount').value;
			get('/api/dashboard/getEngineHistory', 'count=' + s);
		}
	</script>

<hr/>
<h3>/api/dashboard/testDatabase</h3>

	<button type="button" onclick="testDatabase()">Submit</button>

	<script>
		function testDatabase() {
			get('/api/dashboard/testDatabase');
		}
	</script>

<hr/>
<h3>/api/entity/getEntityMap</h3>

	<button type="button" onclick="getEntityMap()">Submit</button>

	<script>
		function getEntityMap() {
			get('/api/entity/getEntityMap');
		}
	</script>


<hr/>
<h3>Results</h3>

<div id="results"></div>




</body>
</html> 
