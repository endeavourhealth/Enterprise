<div class="module">
	<div class="container-fluid">
		<div class="module-heading">
			Report items
		</div>
		<div class="module-body">
			<form>
				<div class="row">
					<div class="form-group col-md-3">
						<library-folder [showMenu]="true" [folderType]="2" (selectionChange)="folderChanged($event)" (itemActioned)="actionItem($event)"></library-folder>
					</div>
					<div class="form-group col-md-9">
						<div class="row">
							<div class="col-md-12">
								<div class="table scroll-box-300">
								<table class="table table-striped table-condensed">
									<thead>
										<tr>
											<th class="col-md-5" (click)="sortField='name'; sortReverse=!sortReverse">Title
												<span *ngIf="sortField == 'name'"
															class="fa fa-sm"
															[ngClass]="{'fa-chevron-down':!sortReverse, 'fa-chevron-up':sortReverse}"></span>
											</th>
											<th class="col-md-3" (click)="sortField='lastModified'; sortReverse=!sortReverse">Date modified
												<span *ngIf="sortField == 'lastModified'"
															class="fa fa-sm"
															[ngClass]="{'fa-chevron-down':!sortReverse, 'fa-chevron-up':sortReverse}"></span>
											</th>
											<th class="col-md-2" (click)="sortField='type'; sortReverse=!sortReverse">Type
												<span *ngIf="sortField == 'type'"
															class="fa fa-sm"
															[ngClass]="{'fa-chevron-down':!sortReverse, 'fa-chevron-up':sortReverse}"></span>
											</th>
											<th class="col-md-2"></th>
										</tr>
									</thead>
									<tbody>
										<tr class="hover-box show-child-on-hover" style="cursor: pointer"
												*ngFor="let item of getReportList()"
												[ngClass]="{'selection': item?.uuid == selectedReport?.uuid}"
												(click)="selectFolderItem(item)">
											<td>
												<a (click)="actionItem(item?.uuid, item.type, 'edit')">{{item.name}}</a>
												<span class="fa fa-info-circle fa-right-pad text-muted" ngbTooltip="{{item.description}}" *ngIf="item.description"></span>
											</td>
											<td>{{item.lastModified | date:'dd-MMM-yyyy HH:mm:ss'}}</td>
											<td><span class="fa fa-right-pad {{item.type | itemTypeIdToIcon}} text-muted"></span>{{item.type | itemTypeIdToString}}</td>
											<td>
												<div class="child-to-show">
													<button type="button" class="btn btn-primary btn-xs" (click)="run(item)">Queue</button>
													<div ngbDropdown class="child-to-show">
														<button type="button" class="btn btn-xs btn-default" ngbDropdownToggle id="itemMenu">...</button>
														<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="itemMenu">
															<li class="disabled"><a href="#">Rename</a></li>
															<li><a (click)="deleteItem(item)">Delete</a></li>
															<li role="separator" class="divider"></li>
															<li><a (click)="cutItem(item)">Cut</a></li>
															<li><a (click)="copyItem(item)">Copy</a></li>
														</ul>
													</div>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							</div>
						</div>
						<div class="row module-footer">
							<div class="col-md-4 zero-pad">
								<div class="bordered-box scroll-box-300">
									<div class="table">
										<table class="table table-striped table-condensed">
											<thead>
												<tr>
													<th class="col-md-7">Date</th>
													<th class="col-md-5">Status</th>
												</tr>
											</thead>
											<tbody>
												<tr class="hover-box" style="cursor: pointer"
														*ngFor="let schedule of selectedReportSchedules"
														[ngClass]="{'selection': schedule?.uuid == selectedSchedule?.uuid}"
														(click)="selectSchedule(schedule)">
													<td>{{ schedule.date | date:'dd-MMM-yyyy HH:mm:ss' }}</td>
													<td>
														<span class="text-muted fa fa-clock-o" *ngIf="schedule.status == 'Scheduled'"></span>
														<span class="text-muted fa fa-check" *ngIf="schedule.status != 'Scheduled'"></span>
														{{ schedule.status }}
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
							<div class="col-md-8 zero-pad">
								<div class="bordered-box scroll-box-300">
									<ngb-tabset>
										<ngb-tab id="0" title="Parameters">
											<template ngbTabContent>
												<div class="panel-body">
												<div class="row">
													<label class="col-md-3">Baseline date :</label>
													<p class="col-md-9">{{ selectedSchedule?.parameters.baselineDate | date:'dd-MMM-yyyy' }}</p>
												</div>
												<div class="row">
													<label class="col-md-3">Patient type : </label>
													<p class="col-md-9">{{ selectedSchedule?.parameters.patientType }}</p>
												</div>
												<div class="row">
													<label class="col-md-3">Patient status : </label>
													<p class="col-md-9">{{ selectedSchedule?.parameters.patientStatus }}</p>
												</div>
											</div>
											</template>
										</ngb-tab>
										<ngb-tab id="1" title="Results">
											<template ngbTabContent>
												<div class="panel-body">
												<div class="row">
													<label class="col-md-3">Population count :</label>
													<p class="col-md-9">{{ selectedScheduleResults?.populationCount | number }}</p>
												</div>

												<Tree [nodes]="getResults()" [options]="options">
													<template #treeNodeTemplate let-node>
														<div class="row">
															<div class="col-md-6">
																<span	*ngIf="!node.data.childQueries" data-nodrag class="fa fa-sm fa-blank text-muted"></span>
																<span *ngIf="node.data.childQueries" data-nodrag	class="fa fa-sm text-muted"
																			[ngClass]="{'fa-chevron-right': !node.isExpanded,'fa-chevron-down': node.isExpanded}"
																			(click)="node.isExpanded = !node.isExpanded"></span>
																<span>{{node.data.name}}</span>
																<span class="fa fa-info-circle fa-right-pad text-muted" ngbTooltip="{{node.data.description}}" *ngIf="node.data.description"></span>
															</div>
															<div class="col-md-3">
																<span>{{node.data.resultCount | number }}</span>
															</div>
															<div class="col-md-3">
																<span>{{ node.data.percentageOfParent }}</span>
															</div>
														</div>
													</template>
												</Tree>

											</div>
											</template>
										</ngb-tab>
									</ngb-tabset>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
